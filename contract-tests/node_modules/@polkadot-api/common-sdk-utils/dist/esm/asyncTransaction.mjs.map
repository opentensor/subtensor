{"version":3,"file":"asyncTransaction.mjs","sources":["../../src/asyncTransaction.ts"],"sourcesContent":["import type { Transaction, Binary } from \"polkadot-api\"\nimport { from, switchMap } from \"rxjs\"\n\nexport type AsyncTransaction<\n  Arg extends {} | undefined = any,\n  Pallet extends string = any,\n  Name extends string = any,\n  Asset = any,\n> = Omit<\n  Transaction<Arg, Pallet, Name, Asset>,\n  \"decodedCall\" | \"getEncodedData\"\n> & {\n  decodedCall: Promise<Transaction<Arg, Pallet, Name, Asset>[\"decodedCall\"]>\n  getEncodedData: () => Promise<Binary>\n  waited: Promise<Transaction<Arg, Pallet, Name, Asset>>\n}\n\nexport const wrapAsyncTx = <\n  Arg extends {} | undefined,\n  Pallet extends string,\n  Name extends string,\n  Asset,\n>(\n  fn: () => Promise<Transaction<Arg, Pallet, Name, Asset>>,\n): AsyncTransaction<Arg, Pallet, Name, Asset> => {\n  const promise = fn()\n\n  // Prevent some runtimes from terminating for an uncaught exception\n  promise.catch((ex) => {\n    console.error(ex)\n  })\n\n  return {\n    sign: (...args) => promise.then((tx) => tx.sign(...args)),\n    signSubmitAndWatch: (...args) =>\n      from(promise).pipe(switchMap((tx) => tx.signSubmitAndWatch(...args))),\n    signAndSubmit: (...args) => promise.then((tx) => tx.signAndSubmit(...args)),\n    getEstimatedFees: (...args) =>\n      promise.then((tx) => tx.getEstimatedFees(...args)),\n    getPaymentInfo: (...args) =>\n      promise.then((tx) => tx.getPaymentInfo(...args)),\n    decodedCall: promise.then((tx) => tx.decodedCall),\n    getEncodedData: () => promise.then((tx) => tx.getEncodedData()),\n    waited: promise,\n  }\n}\n"],"names":[],"mappings":";;AAiBO,MAAM,WAAA,GAAc,CAMzB,EAAA,KAC+C;AAC/C,EAAA,MAAM,UAAU,EAAA,EAAG;AAGnB,EAAA,OAAA,CAAQ,KAAA,CAAM,CAAC,EAAA,KAAO;AACpB,IAAA,OAAA,CAAQ,MAAM,EAAE,CAAA;AAAA,EAClB,CAAC,CAAA;AAED,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,CAAA,GAAI,IAAA,KAAS,OAAA,CAAQ,IAAA,CAAK,CAAC,EAAA,KAAO,EAAA,CAAG,IAAA,CAAK,GAAG,IAAI,CAAC,CAAA;AAAA,IACxD,kBAAA,EAAoB,CAAA,GAAI,IAAA,KACtB,IAAA,CAAK,OAAO,CAAA,CAAE,IAAA,CAAK,SAAA,CAAU,CAAC,OAAO,EAAA,CAAG,kBAAA,CAAmB,GAAG,IAAI,CAAC,CAAC,CAAA;AAAA,IACtE,aAAA,EAAe,CAAA,GAAI,IAAA,KAAS,OAAA,CAAQ,IAAA,CAAK,CAAC,EAAA,KAAO,EAAA,CAAG,aAAA,CAAc,GAAG,IAAI,CAAC,CAAA;AAAA,IAC1E,gBAAA,EAAkB,CAAA,GAAI,IAAA,KACpB,OAAA,CAAQ,IAAA,CAAK,CAAC,EAAA,KAAO,EAAA,CAAG,gBAAA,CAAiB,GAAG,IAAI,CAAC,CAAA;AAAA,IACnD,cAAA,EAAgB,CAAA,GAAI,IAAA,KAClB,OAAA,CAAQ,IAAA,CAAK,CAAC,EAAA,KAAO,EAAA,CAAG,cAAA,CAAe,GAAG,IAAI,CAAC,CAAA;AAAA,IACjD,aAAa,OAAA,CAAQ,IAAA,CAAK,CAAC,EAAA,KAAO,GAAG,WAAW,CAAA;AAAA,IAChD,cAAA,EAAgB,MAAM,OAAA,CAAQ,IAAA,CAAK,CAAC,EAAA,KAAO,EAAA,CAAG,gBAAgB,CAAA;AAAA,IAC9D,MAAA,EAAQ;AAAA,GACV;AACF;;;;"}