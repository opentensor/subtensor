{"version":3,"file":"get-sync-provider.mjs","sources":["../../src/get-sync-provider.ts"],"sourcesContent":["import type { JsonRpcProvider } from \"@polkadot-api/json-rpc-provider\"\nimport { getProxy } from \"./get-proxy\"\nimport { AsyncJsonRpcProvider } from \"./public-types\"\nimport { ConnectableJsonRpcConnection } from \"./internal-types\"\n\nexport const getSyncProvider =\n  (input: () => Promise<AsyncJsonRpcProvider>): JsonRpcProvider =>\n  (onMessage) => {\n    let proxy: ConnectableJsonRpcConnection | null = getProxy(onMessage)\n\n    const start = () => {\n      input().then(\n        (cb) => {\n          if (!proxy) {\n            try {\n              cb(\n                () => {},\n                () => {},\n              ).disconnect()\n            } catch (_) {}\n          } else\n            proxy.connect((onMsg, onHalt) =>\n              cb(onMsg, () => {\n                onHalt()\n                start()\n              }),\n            )\n        },\n        () => {\n          proxy && setTimeout(start, 0)\n        },\n      )\n    }\n\n    start()\n    return {\n      send: (msg) => {\n        proxy?.send(msg)\n      },\n      disconnect: () => {\n        proxy?.disconnect()\n        proxy = null\n      },\n    }\n  }\n"],"names":[],"mappings":";;AAKO,MAAM,eAAA,GACX,CAAC,KAAA,KACD,CAAC,SAAA,KAAc;AACb,EAAA,IAAI,KAAA,GAA6C,SAAS,SAAS,CAAA;AAEnE,EAAA,MAAM,QAAQ,MAAM;AAClB,IAAA,KAAA,EAAM,CAAE,IAAA;AAAA,MACN,CAAC,EAAA,KAAO;AACN,QAAA,IAAI,CAAC,KAAA,EAAO;AACV,UAAA,IAAI;AACF,YAAA,EAAA;AAAA,cACE,MAAM;AAAA,cAAC,CAAA;AAAA,cACP,MAAM;AAAA,cAAC;AAAA,cACP,UAAA,EAAW;AAAA,UACf,SAAS,CAAA,EAAG;AAAA,UAAC;AAAA,QACf,CAAA;AACE,UAAA,KAAA,CAAM,OAAA;AAAA,YAAQ,CAAC,KAAA,EAAO,MAAA,KACpB,EAAA,CAAG,OAAO,MAAM;AACd,cAAA,MAAA,EAAO;AACP,cAAA,KAAA,EAAM;AAAA,YACR,CAAC;AAAA,WACH;AAAA,MACJ,CAAA;AAAA,MACA,MAAM;AACJ,QAAA,KAAA,IAAS,UAAA,CAAW,OAAO,CAAC,CAAA;AAAA,MAC9B;AAAA,KACF;AAAA,EACF,CAAA;AAEA,EAAA,KAAA,EAAM;AACN,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,CAAC,GAAA,KAAQ;AACb,MAAA,KAAA,EAAO,KAAK,GAAG,CAAA;AAAA,IACjB,CAAA;AAAA,IACA,YAAY,MAAM;AAChB,MAAA,KAAA,EAAO,UAAA,EAAW;AAClB,MAAA,KAAA,GAAQ,IAAA;AAAA,IACV;AAAA,GACF;AACF;;;;"}