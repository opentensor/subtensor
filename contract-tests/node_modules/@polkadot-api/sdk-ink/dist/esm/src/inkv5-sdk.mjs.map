{"version":3,"file":"inkv5-sdk.mjs","sources":["../../../src/inkv5-sdk.ts"],"sourcesContent":["import { Enum, SS58String } from \"polkadot-api\"\nimport type {\n  GenericInkDescriptors,\n  InkSdkTypedApi,\n  StorageError,\n} from \"./descriptor-types\"\nimport { inkEncoding } from \"./encoding-provider\"\nimport { getContract } from \"./get-contract\"\nimport { getDeployer } from \"./get-deployer\"\nimport { contractsProvider } from \"./provider\"\nimport { defaultOptions, type InkV5Sdk, type InkSdkOptions } from \"./sdk-types\"\n\nexport const createInkV5Sdk = <\n  T extends InkSdkTypedApi,\n  D extends GenericInkDescriptors,\n>(\n  typedApi: T,\n  contractDescriptors: D,\n  options?: Partial<InkSdkOptions>,\n): InkV5Sdk<T, D, SS58String, StorageError> => {\n  const { atBest } = { ...defaultOptions, ...options }\n\n  const provider = contractsProvider(typedApi, atBest)\n  const encodingProvider = inkEncoding(contractDescriptors)\n\n  return {\n    getContract: (address) =>\n      getContract(provider, encodingProvider, address, (v) => v, address),\n    getDeployer: (code) =>\n      getDeployer(provider, encodingProvider, Enum(\"Upload\", code), (v) => v),\n    readDeploymentEvents(events) {\n      const instantiatedEvents =\n        events\n          ?.filter(\n            (evt) =>\n              evt.type === \"Contracts\" &&\n              (evt.value as any).type === \"Instantiated\",\n          )\n          .map(\n            (v) =>\n              (v.value as any).value as {\n                deployer: string\n                contract: string\n              },\n          ) ?? []\n\n      return instantiatedEvents.map((evt) => ({\n        address: evt.contract,\n        contractEvents: encodingProvider.filterEvents(evt.contract, events),\n      }))\n    },\n  }\n}\n"],"names":[],"mappings":";;;;;;;AAYO,MAAM,cAAA,GAAiB,CAI5B,QAAA,EACA,mBAAA,EACA,OAAA,KAC6C;AAC7C,EAAA,MAAM,EAAE,MAAA,EAAO,GAAI,EAAE,GAAG,cAAA,EAAgB,GAAG,OAAA,EAAQ;AAEnD,EAAA,MAAM,QAAA,GAAW,iBAAA,CAAkB,QAAA,EAAU,MAAM,CAAA;AACnD,EAAA,MAAM,gBAAA,GAAmB,YAAY,mBAAmB,CAAA;AAExD,EAAA,OAAO;AAAA,IACL,WAAA,EAAa,CAAC,OAAA,KACZ,WAAA,CAAY,QAAA,EAAU,kBAAkB,OAAA,EAAS,CAAC,CAAA,KAAM,CAAA,EAAG,OAAO,CAAA;AAAA,IACpE,WAAA,EAAa,CAAC,IAAA,KACZ,WAAA,CAAY,QAAA,EAAU,gBAAA,EAAkB,IAAA,CAAK,QAAA,EAAU,IAAI,CAAA,EAAG,CAAC,CAAA,KAAM,CAAC,CAAA;AAAA,IACxE,qBAAqB,MAAA,EAAQ;AAC3B,MAAA,MAAM,qBACJ,MAAA,EACI,MAAA;AAAA,QACA,CAAC,GAAA,KACC,GAAA,CAAI,SAAS,WAAA,IACZ,GAAA,CAAI,MAAc,IAAA,KAAS;AAAA,OAChC,CACC,GAAA;AAAA,QACC,CAAC,CAAA,KACE,CAAA,CAAE,KAAA,CAAc;AAAA,WAIhB,EAAC;AAEV,MAAA,OAAO,kBAAA,CAAmB,GAAA,CAAI,CAAC,GAAA,MAAS;AAAA,QACtC,SAAS,GAAA,CAAI,QAAA;AAAA,QACb,cAAA,EAAgB,gBAAA,CAAiB,YAAA,CAAa,GAAA,CAAI,UAAU,MAAM;AAAA,OACpE,CAAE,CAAA;AAAA,IACJ;AAAA,GACF;AACF;;;;"}