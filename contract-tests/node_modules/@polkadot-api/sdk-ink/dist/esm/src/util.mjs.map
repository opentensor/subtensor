{"version":3,"file":"util.mjs","sources":["../../../src/util.ts"],"sourcesContent":["import { RLP } from \"@ethereumjs/rlp\"\nimport { Keccak256 } from \"@polkadot-api/substrate-bindings\"\nimport {\n  AccountId,\n  Binary,\n  Enum,\n  FixedSizeBinary,\n  HexString,\n  SS58String,\n} from \"polkadot-api\"\nimport { mergeUint8 } from \"polkadot-api/utils\"\nimport { ReviveAddress, ReviveSdkTypedApi, U256 } from \"./descriptor-types\"\n\nexport const getSignedStorage = (\n  depositResponse: Enum<{\n    Refund: bigint\n    Charge: bigint\n  }>,\n) =>\n  depositResponse.type === \"Charge\"\n    ? depositResponse.value\n    : -depositResponse.value\n\nexport const getStorageLimit = (\n  depositResponse: Enum<{\n    Refund: bigint\n    Charge: bigint\n  }>,\n) => (depositResponse.type === \"Charge\" ? depositResponse.value : 0n)\n\nexport const ss58ToEthereum = (address: SS58String): Binary =>\n  Binary.fromBytes(Keccak256(AccountId().enc(address)).slice(12))\n\n/**\n * @deprecated Use `createInkSdk(client).addressIsMapped(address)` instead.\n */\nexport const reviveAddressIsMapped = (\n  typedApi: ReviveSdkTypedApi,\n  address: SS58String,\n) =>\n  typedApi.query.Revive.OriginalAccount.getValue(ss58ToEthereum(address)).then(\n    (r) => r != null,\n  )\n\nconst u64Range = 2n ** 64n\nexport const valueToU256 = (value: bigint, nativeToEth: number): U256 => {\n  const scaled = value * BigInt(nativeToEth)\n  return [\n    scaled % u64Range,\n    (scaled / u64Range) % u64Range,\n    (scaled / u64Range ** 2n) % u64Range,\n    (scaled / u64Range ** 3n) % u64Range,\n  ]\n}\nexport const u256ToValue = (u256: U256, nativeToEth: number): bigint => {\n  const scaled = u256.reduce(\n    (acc, value, i) => acc + value * u64Range ** BigInt(i),\n    0n,\n  )\n  return scaled / BigInt(nativeToEth)\n}\n\nconst parseReviveAddress = (address: SS58String | ReviveAddress | HexString) =>\n  typeof address === \"string\"\n    ? address.startsWith(\"0x\")\n      ? Binary.fromHex(address)\n      : ss58ToEthereum(address)\n    : address\n\n// Ported from https://github.com/paritytech/polkadot-sdk/blob/c5ae50f86b8b727428eb86d9b1027a8f56fee19d/substrate/frame/revive/src/address.rs#L233\nexport const getDeploymentAddressWithNonce = (\n  deployer: SS58String | ReviveAddress | HexString,\n  nonce: number,\n) => {\n  const addr = parseReviveAddress(deployer)\n  const data = RLP.encode([addr.asBytes(), nonce])\n  const bytes = Keccak256(data).slice(12)\n  return Binary.fromBytes(bytes)\n}\n\n// Ported from https://github.com/paritytech/polkadot-sdk/blob/c5ae50f86b8b727428eb86d9b1027a8f56fee19d/substrate/frame/revive/src/address.rs#L242\nexport const getDeploymentAddressWithSalt = (\n  deployer: SS58String | ReviveAddress | HexString,\n  deploymentHash: HexString,\n  salt: HexString | FixedSizeBinary<32>,\n) => {\n  const addr = parseReviveAddress(deployer)\n  const saltBin = typeof salt === \"string\" ? Binary.fromHex(salt) : salt\n  const bytes = Keccak256(\n    mergeUint8([\n      new Uint8Array([0xff]),\n      addr.asBytes(),\n      saltBin.asBytes(),\n      Binary.fromHex(deploymentHash).asBytes(),\n    ]),\n  ).slice(12)\n\n  return Binary.fromBytes(bytes)\n}\n\nexport const getDeploymentHash = (code: Binary, inputData: Binary): HexString =>\n  Binary.fromBytes(\n    Keccak256(mergeUint8(code.asBytes(), inputData.asBytes())),\n  ).asHex()\n"],"names":[],"mappings":";;;;;AAaO,MAAM,gBAAA,GAAmB,CAC9B,eAAA,KAKA,eAAA,CAAgB,SAAS,QAAA,GACrB,eAAA,CAAgB,KAAA,GAChB,CAAC,eAAA,CAAgB;AAEhB,MAAM,kBAAkB,CAC7B,eAAA,KAII,gBAAgB,IAAA,KAAS,QAAA,GAAW,gBAAgB,KAAA,GAAQ;AAE3D,MAAM,cAAA,GAAiB,CAAC,OAAA,KAC7B,MAAA,CAAO,UAAU,SAAA,CAAU,SAAA,EAAU,CAAE,GAAA,CAAI,OAAO,CAAC,CAAA,CAAE,KAAA,CAAM,EAAE,CAAC;AAKzD,MAAM,qBAAA,GAAwB,CACnC,QAAA,EACA,OAAA,KAEA,QAAA,CAAS,KAAA,CAAM,MAAA,CAAO,eAAA,CAAgB,QAAA,CAAS,cAAA,CAAe,OAAO,CAAC,CAAA,CAAE,IAAA;AAAA,EACtE,CAAC,MAAM,CAAA,IAAK;AACd;AAEF,MAAM,WAAW,EAAA,IAAM,GAAA;AAChB,MAAM,WAAA,GAAc,CAAC,KAAA,EAAe,WAAA,KAA8B;AACvE,EAAA,MAAM,MAAA,GAAS,KAAA,GAAQ,MAAA,CAAO,WAAW,CAAA;AACzC,EAAA,OAAO;AAAA,IACL,MAAA,GAAS,QAAA;AAAA,IACR,SAAS,QAAA,GAAY,QAAA;AAAA,IACrB,MAAA,GAAS,YAAY,EAAA,GAAM,QAAA;AAAA,IAC3B,MAAA,GAAS,YAAY,EAAA,GAAM;AAAA,GAC9B;AACF;AACO,MAAM,WAAA,GAAc,CAAC,IAAA,EAAY,WAAA,KAAgC;AACtE,EAAA,MAAM,SAAS,IAAA,CAAK,MAAA;AAAA,IAClB,CAAC,KAAK,KAAA,EAAO,CAAA,KAAM,MAAM,KAAA,GAAQ,QAAA,IAAY,OAAO,CAAC,CAAA;AAAA,IACrD;AAAA,GACF;AACA,EAAA,OAAO,MAAA,GAAS,OAAO,WAAW,CAAA;AACpC;AAEA,MAAM,qBAAqB,CAAC,OAAA,KAC1B,OAAO,OAAA,KAAY,WACf,OAAA,CAAQ,UAAA,CAAW,IAAI,CAAA,GACrB,OAAO,OAAA,CAAQ,OAAO,CAAA,GACtB,cAAA,CAAe,OAAO,CAAA,GACxB,OAAA;AAGC,MAAM,6BAAA,GAAgC,CAC3C,QAAA,EACA,KAAA,KACG;AACH,EAAA,MAAM,IAAA,GAAO,mBAAmB,QAAQ,CAAA;AACxC,EAAA,MAAM,IAAA,GAAO,IAAI,MAAA,CAAO,CAAC,KAAK,OAAA,EAAQ,EAAG,KAAK,CAAC,CAAA;AAC/C,EAAA,MAAM,KAAA,GAAQ,SAAA,CAAU,IAAI,CAAA,CAAE,MAAM,EAAE,CAAA;AACtC,EAAA,OAAO,MAAA,CAAO,UAAU,KAAK,CAAA;AAC/B;AAGO,MAAM,4BAAA,GAA+B,CAC1C,QAAA,EACA,cAAA,EACA,IAAA,KACG;AACH,EAAA,MAAM,IAAA,GAAO,mBAAmB,QAAQ,CAAA;AACxC,EAAA,MAAM,UAAU,OAAO,IAAA,KAAS,WAAW,MAAA,CAAO,OAAA,CAAQ,IAAI,CAAA,GAAI,IAAA;AAClE,EAAA,MAAM,KAAA,GAAQ,SAAA;AAAA,IACZ,UAAA,CAAW;AAAA,MACT,IAAI,UAAA,CAAW,CAAC,GAAI,CAAC,CAAA;AAAA,MACrB,KAAK,OAAA,EAAQ;AAAA,MACb,QAAQ,OAAA,EAAQ;AAAA,MAChB,MAAA,CAAO,OAAA,CAAQ,cAAc,CAAA,CAAE,OAAA;AAAQ,KACxC;AAAA,GACH,CAAE,MAAM,EAAE,CAAA;AAEV,EAAA,OAAO,MAAA,CAAO,UAAU,KAAK,CAAA;AAC/B;AAEO,MAAM,iBAAA,GAAoB,CAAC,IAAA,EAAc,SAAA,KAC9C,MAAA,CAAO,SAAA;AAAA,EACL,SAAA,CAAU,WAAW,IAAA,CAAK,OAAA,IAAW,SAAA,CAAU,OAAA,EAAS,CAAC;AAC3D,CAAA,CAAE,KAAA;;;;"}