function getStorage(provider, encodingProvider, address) {
  const getStorage2 = async (label, key) => {
    const storage = encodingProvider.storage(label);
    const result = await provider.getStorage(
      address,
      storage.encode(key)
    );
    if (result.success) {
      return {
        success: true,
        value: result.value ? storage.decode(result.value) : void 0
      };
    }
    return {
      success: false,
      value: result.value
    };
  };
  return {
    async getNested(label, ...args) {
      return getStorage2(label, args[0]);
    },
    async getRoot() {
      const root = await getStorage2("", void 0);
      if (!root.success) {
        return root;
      }
      const value = root.value;
      for (const path of encodingProvider.storagePaths()) {
        if (path === "") continue;
        assignFnAtPath(
          value,
          path.split("."),
          (key) => getStorage2(path, key)
        );
      }
      return {
        success: true,
        value
      };
    }
  };
}
const assignFnAtPath = (target, segments, value) => {
  const [current, ...rest] = segments;
  if (rest.length === 0) {
    if (typeof target[current] === "object") {
      target[current] = Object.assign(value, target[current]);
    } else {
      target[current] = value;
    }
  } else {
    target[current] = current in target ? target[current] : {};
    assignFnAtPath(target[current], rest, value);
  }
};

export { getStorage };
//# sourceMappingURL=get-storage.mjs.map
