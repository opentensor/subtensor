{"version":3,"file":"provider.mjs","sources":["../../../src/provider.ts"],"sourcesContent":["import { mapResult, Result } from \"@polkadot-api/common-sdk-utils\"\nimport { GenericEvent } from \"@polkadot-api/ink-contracts\"\nimport {\n  Binary,\n  CompatibilityLevel,\n  Enum,\n  FixedSizeBinary,\n  ResultPayload,\n  SS58String,\n  Transaction,\n} from \"polkadot-api\"\nimport { mergeUint8 } from \"polkadot-api/utils\"\nimport {\n  DryRunCallParams,\n  DryRunCallResult,\n  DryRunInstantiateParams,\n  DryRunInstantiateResult,\n  Gas,\n  GenericTransaction,\n  InkSdkTypedApi,\n  NewReviveSdkTypedApi,\n  OldReviveSdkTypedApi,\n  ReviveAddress,\n  ReviveSdkTypedApi,\n  ReviveStorageError,\n  StorageError,\n  TraceCallResult,\n} from \"./descriptor-types\"\nimport {\n  getDeploymentAddressWithNonce,\n  getDeploymentAddressWithSalt,\n  getDeploymentHash,\n  ss58ToEthereum,\n  u256ToValue,\n  valueToU256,\n} from \"./util\"\n\nexport interface ContractsProvider<Addr, StorageErr> {\n  getBalance(addr: Addr): Promise<bigint>\n  dryRunCall(...args: DryRunCallParams<Addr>): Promise<DryRunCallResult>\n  dryRunInstantiate(\n    ...args: DryRunInstantiateParams\n  ): Promise<DryRunInstantiateResult<{ addr: Addr }>>\n  getEstimatedAddress(\n    origin: SS58String,\n    value: bigint,\n    code: Enum<{\n      Upload: Binary\n      Existing: FixedSizeBinary<32>\n    }>,\n    data: Binary,\n    salt?: Binary,\n    nonce?: number,\n  ): Promise<Addr | null>\n  getStorage(\n    addr: Addr,\n    key: Binary,\n  ): Promise<ResultPayload<Binary | undefined, StorageErr>>\n  getCodeHash(addr: Addr): Promise<FixedSizeBinary<32> | undefined>\n  txCall(payload: {\n    dest: Addr\n    value: bigint\n    gas_limit: Gas\n    storage_deposit_limit?: bigint\n    data: Binary\n  }): Transaction<any, any, any, any>\n  txInstantiate(payload: {\n    value: bigint\n    gas_limit: Gas\n    storage_deposit_limit?: bigint\n    code_hash: FixedSizeBinary<32>\n    data: Binary\n    salt?: Binary\n  }): Transaction<any, any, any, any>\n  txInstantiateWithCode(payload: {\n    value: bigint\n    gas_limit: Gas\n    storage_deposit_limit?: bigint\n    code: Binary\n    data: Binary\n    salt?: Binary\n  }): Transaction<any, any, any, any>\n}\n\nconst defaultSalt = Binary.fromText(\"\")\nexport const contractsProvider = (\n  typedApi: InkSdkTypedApi,\n  atBest?: boolean,\n): ContractsProvider<SS58String, StorageError> => {\n  const callOptions = atBest ? { at: \"best\" } : {}\n  const dryRunInstantiate = async (\n    origin: SS58String,\n    value: bigint,\n    gas_limit: Gas | undefined,\n    storage_deposit_limit: bigint | undefined,\n    code: Enum<{\n      Upload: Binary\n      Existing: FixedSizeBinary<32>\n    }>,\n    data: Binary,\n    salt: Binary | undefined,\n  ) => {\n    const response = await typedApi.apis.ContractsApi.instantiate(\n      origin,\n      value,\n      gas_limit,\n      storage_deposit_limit,\n      code,\n      data,\n      salt ?? defaultSalt,\n      callOptions,\n    )\n    const result: Result<\n      {\n        result: {\n          flags: number\n          data: Binary\n        }\n      } & {\n        account_id: SS58String\n      }\n    > = response.result\n    return {\n      ...response,\n      result: mapResult(result, {\n        value: ({ account_id, result }) => ({\n          result,\n          addr: account_id,\n        }),\n      }),\n    }\n  }\n\n  return {\n    async getBalance(addr) {\n      const account = await typedApi.query.System.Account.getValue(addr)\n      return account.data.free\n    },\n    dryRunCall: (...args) =>\n      typedApi.apis.ContractsApi.call(...args, callOptions),\n    dryRunInstantiate,\n    getEstimatedAddress: async (origin, value, code, data, salt) => {\n      const result = await dryRunInstantiate(\n        origin,\n        value,\n        undefined,\n        undefined,\n        code,\n        data,\n        salt,\n      )\n      return result.result.success ? result.result.value.addr : null\n    },\n    getStorage: (...args) =>\n      typedApi.apis.ContractsApi.get_storage(...args, callOptions),\n    getCodeHash: (addr) =>\n      typedApi.query.Contracts.ContractInfoOf.getValue(addr, callOptions).then(\n        (r) => r?.code_hash,\n      ),\n    txCall: ({ data, dest, gas_limit, value, storage_deposit_limit }) =>\n      typedApi.tx.Contracts.call({\n        data,\n        dest: {\n          type: \"Id\",\n          value: dest,\n        },\n        gas_limit,\n        storage_deposit_limit,\n        value,\n      }),\n    txInstantiate: (payload) =>\n      typedApi.tx.Contracts.instantiate({\n        storage_deposit_limit: undefined,\n        ...payload,\n        salt: payload.salt ?? defaultSalt,\n      }),\n    txInstantiateWithCode: (payload) =>\n      typedApi.tx.Contracts.instantiate_with_code({\n        storage_deposit_limit: undefined,\n        ...payload,\n        salt: payload.salt ?? defaultSalt,\n      }),\n  }\n}\n\nconst logToEvent = ({\n  address,\n  topics,\n  data,\n}: {\n  address: FixedSizeBinary<20>\n  topics: Array<FixedSizeBinary<32>>\n  data: Binary\n}): {\n  event: GenericEvent\n  topics: Binary[]\n} => ({\n  topics,\n  event: {\n    type: \"Revive\",\n    value: {\n      type: \"ContractEmitted\",\n      value: {\n        contract: address,\n        data,\n      },\n    },\n  },\n})\nconst getEventsFromTrace = (\n  trace: TraceCallResult,\n): Array<{\n  event: GenericEvent\n  topics: Binary[]\n}> => [\n  ...trace.logs.map(logToEvent),\n  ...trace.calls.flatMap(getEventsFromTrace),\n]\n\nexport const reviveProvider = (\n  typedApi: ReviveSdkTypedApi,\n  atBest: boolean,\n): ContractsProvider<ReviveAddress, ReviveStorageError> => {\n  const callOptions = atBest ? { at: \"best\" } : {}\n  const traceCall = ({\n    from,\n    to,\n    input,\n    value,\n  }: Pick<GenericTransaction, \"from\" | \"to\" | \"input\" | \"value\">) =>\n    typedApi.apis.ReviveApi.trace_call(\n      {\n        authorization_list: [],\n        blob_versioned_hashes: [],\n        blobs: [],\n        from,\n        input,\n        to,\n        value,\n      },\n      Enum(\"CallTracer\", {\n        only_top_call: false,\n        with_logs: true,\n      }),\n      callOptions,\n    ).catch((ex) => {\n      console.error(ex)\n      return {\n        success: false as const,\n      }\n    })\n\n  return {\n    async getBalance(addr) {\n      const ethBalance = await typedApi.apis.ReviveApi.balance(addr)\n      const nativeToEth = await typedApi.constants.Revive.NativeToEthRatio()\n\n      return u256ToValue(ethBalance, nativeToEth)\n    },\n    dryRunCall: (\n      origin: SS58String,\n      dest: ReviveAddress,\n      value: bigint,\n      gas_limit: Gas | undefined,\n      storage_deposit_limit: bigint | undefined,\n      input: Binary,\n    ) =>\n      Promise.all([\n        typedApi.apis.ReviveApi.call(\n          origin,\n          dest,\n          value,\n          gas_limit,\n          storage_deposit_limit,\n          input,\n          callOptions,\n        ),\n        traceCall({\n          from: ss58ToEthereum(origin),\n          input: {\n            input,\n          },\n          to: dest,\n        }),\n      ]).then(([call, trace]) => {\n        const events = (() => {\n          if (call.events) return call.events\n          if (!trace.success) return undefined\n\n          if (\"type\" in trace.value) {\n            if (trace.value.type === \"Prestate\") {\n              console.error(\"Unexpected prestate response for events\")\n              return undefined\n            }\n            return getEventsFromTrace(trace.value.value)\n          }\n          return getEventsFromTrace(trace.value)\n        })()\n\n        return {\n          ...call,\n          events,\n        }\n      }),\n    dryRunInstantiate: (\n      origin: SS58String,\n      value: bigint,\n      gas_limit: Gas | undefined,\n      storage_deposit_limit: bigint | undefined,\n      code: Enum<{\n        Upload: Binary\n        Existing: FixedSizeBinary<32>\n      }>,\n      data: Binary,\n      salt: Binary | undefined,\n    ) =>\n      Promise.all([\n        typedApi.apis.ReviveApi.instantiate(\n          origin,\n          value,\n          gas_limit,\n          storage_deposit_limit,\n          code,\n          data,\n          salt,\n          callOptions,\n        ),\n        typedApi.constants.Revive.NativeToEthRatio().then((nativeToEth) =>\n          traceCall({\n            from: ss58ToEthereum(origin),\n            input: {\n              input: Binary.fromBytes(\n                mergeUint8([code.value.asBytes(), data.asBytes()]),\n              ),\n            },\n            value: valueToU256(value, nativeToEth),\n          }),\n        ),\n      ]).then(([call, trace]) => {\n        const events = (() => {\n          if (call.events) return call.events\n          if (!trace.success) return undefined\n\n          if (\"type\" in trace.value) {\n            if (trace.value.type === \"Prestate\") {\n              console.error(\"Unexpected prestate response for events\")\n              return undefined\n            }\n            return getEventsFromTrace(trace.value.value)\n          }\n          return getEventsFromTrace(trace.value)\n        })()\n\n        return {\n          ...call,\n          events,\n        }\n      }),\n    getEstimatedAddress: async (\n      origin,\n      _value,\n      code_arg,\n      data,\n      salt,\n      nonce_arg,\n    ) => {\n      if (salt) {\n        const code =\n          code_arg.type === \"Upload\"\n            ? code_arg.value\n            : await typedApi.query.Revive.PristineCode.getValue(\n                code_arg.value,\n                callOptions,\n              )\n        if (!code) return null\n        return getDeploymentAddressWithSalt(\n          origin,\n          getDeploymentHash(code, data),\n          salt,\n        )\n      }\n\n      const nonce =\n        nonce_arg != null\n          ? nonce_arg\n          : (await typedApi.query.System.Account.getValue(origin, callOptions))\n              .nonce\n      return getDeploymentAddressWithNonce(origin, nonce)\n    },\n    getStorage: async (...args) => {\n      // the optional part makes it awkward to work withâ€¦\n      const var_key_call: any = typedApi.apis.ReviveApi.get_storage_var_key\n      const call = var_key_call.isCompatible(CompatibilityLevel.Partial)\n        ? (var_key_call as typeof typedApi.apis.ReviveApi.get_storage)\n        : typedApi.apis.ReviveApi.get_storage\n\n      return call(...args, callOptions)\n    },\n    getCodeHash: async (addr) => {\n      const newApi = typedApi as NewReviveSdkTypedApi\n      if (\n        await newApi.query.Revive.AccountInfoOf.isCompatible(\n          CompatibilityLevel.Partial,\n        )\n      ) {\n        const result = await newApi.query.Revive.AccountInfoOf.getValue(\n          addr,\n          callOptions,\n        )\n        if (result?.account_type.type !== \"Contract\") {\n          return undefined\n        }\n        return result.account_type.value.code_hash\n      }\n\n      const oldApi = typedApi as OldReviveSdkTypedApi\n      const result = await oldApi.query.Revive.ContractInfoOf.getValue(\n        addr,\n        callOptions,\n      )\n      return result?.code_hash\n    },\n    txCall: (payload) => {\n      if (payload.storage_deposit_limit == null) {\n        throw new Error(\"Pallet revive requires storage deposit limit\")\n      }\n      return typedApi.tx.Revive.call({\n        storage_deposit_limit: payload.storage_deposit_limit,\n        ...payload,\n      })\n    },\n    txInstantiate: (payload) => {\n      if (payload.storage_deposit_limit == null) {\n        throw new Error(\"Pallet revive requires storage deposit limit\")\n      }\n      return typedApi.tx.Revive.instantiate({\n        storage_deposit_limit: payload.storage_deposit_limit,\n        salt: payload.salt,\n        ...payload,\n      })\n    },\n    txInstantiateWithCode: (payload) => {\n      if (payload.storage_deposit_limit == null) {\n        throw new Error(\"Pallet revive requires storage deposit limit\")\n      }\n      return typedApi.tx.Revive.instantiate_with_code({\n        storage_deposit_limit: payload.storage_deposit_limit,\n        salt: payload.salt,\n        ...payload,\n      })\n    },\n  }\n}\n"],"names":["result"],"mappings":"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"}